# Проектная работа «Веб-ларёк»

## Стек
- **Сборка**: Webpack 5, Babel
- **Язык**: TypeScript
- **Стили**: SCSS + PostCSS (autoprefixer)
- **Развёртывание**: GitHub Pages (скрипт `deploy`)

## Структура проекта
- `src/` — исходники
  - `components/` — компоненты приложения
    - `base/` — базовая инфраструктура: `api.ts`, `events.ts`
  - `pages/` — HTML-шаблон страницы
  - `scss/` — глобальные стили и переменные
  - `types/` — типы и интерфейсы данных
  - `utils/` — утилиты и константы
- `dist/` — сборка

Важные файлы:
- `src/pages/index.html` — HTML-шаблон главной страницы
- `src/index.ts` — точка входа приложения
- `src/components/base/api.ts` — базовый HTTP-клиент
- `src/components/base/events.ts` — брокер событий
- `src/types/index.ts` — типы доменной модели
- `src/utils/constants.ts` — константы окружения (`API_URL`, `CDN_URL`)
- `src/utils/utils.ts` — утилиты (BEM, DOM-хелперы и т. п.)

## Установка и запуск
```bash
npm install
npm run start
```
Альтернатива:
```bash
yarn
yarn start
```

### Сборка
```bash
npm run build
```
или
```bash
yarn build
```

### Переменные окружения
- `API_ORIGIN` — базовый origin для API и CDN.

Примеры запуска с указанием переменной окружения:
- PowerShell (Windows):
```powershell
$env:API_ORIGIN="https://your.api.host"; npm run start
```
- bash (macOS/Linux):
```bash
API_ORIGIN="https://your.api.host" npm run start
```

---

## Архитектура
Проект реализован в парадигме MV* с разделением на модели (данные/состояние) и представления (отображение), взаимодействующих через **брокер событий** (шина событий). Это обеспечивает:
- **изолированность**: компоненты можно переиспользовать;
- **единственную ответственность**: каждый компонент решает ровно одну задачу;
- **масштабируемость**: легко добавлять функциональность без изменения базового кода.

Управляющий слой реализован событийной моделью: представления публикуют события пользовательских действий, модели и координатор подписываются и реагируют, меняя состояние и/или вызывая API, затем эмитят события обновлений для представлений.

### Базовые классы
- `EventEmitter` — брокер событий.
  - Функции: подписка/отписка на события (`on`/`off`), эмит (`emit`), групповые операции (`onAll`, `offAll`), фабрика-триггер (`trigger`).
- `Api` — базовый HTTP-клиент.
  - Функции: `get(uri)`, `post(uri, data, method)`, обработка ответа `handleResponse` с генерацией ошибок по тексту ответа/статусу.

Пример описания класса:
- «Класс `EventEmitter` обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события, слушать все события и генерировать коллбек-триггер».

### Слои и их ответственность
- **Модели (данные/состояние)**
  - `CatalogModel` — список товаров, состояние загрузки/ошибок, текущая карточка предпросмотра.
  - `BasketModel` — позиции корзины, расчёт суммы, операции добавления/удаления.
  - `OrderModel` — оформление заказа: способ оплаты, адрес, контакты, итоговая сумма, валидация.
  - `AppState` — агрегатор общего состояния (композиция моделей), координация межмодульных событий.
- **Представления (UI-компоненты)**
  - `GalleryView` — отрисовка каталога (сеткой), делегирует карточки `CardView`.
  - `CardView` — карточка товара (в каталоге и в предпросмотре), эмитит выбор/добавление в корзину.
  - `ModalView` — модальное окно (контейнер), управление открытием/закрытием, рендер произвольного контента.
  - `BasketView` — содержимое корзины, список позиций, удаление, кнопка «Оформить».
  - `OrderFormView` — форма адреса и способа оплаты, валидация и состояние кнопки «Далее».
  - `ContactsFormView` — форма контактов (email/phone), валидация и кнопка «Оплатить».
  - `HeaderView` — индикатор количества товаров в корзине.
- **Инфраструктура**
  - `Api` — сетевое взаимодействие.
  - `EventEmitter` — коммуникация между слоями по событиям.

### События
Соглашение: `модуль:действие`.
- Каталог: `catalog:load`, `catalog:loaded`, `catalog:error`, `card:select`, `card:add-to-basket`.
- Корзина: `basket:add`, `basket:remove`, `basket:open`, `basket:changed`.
- Модалка: `modal:open`, `modal:close`.
- Оформление заказа: `order:open`, `order:update`, `order:submit`, `order:success`, `order:error`.
- Контакты: `contacts:update`, `contacts:submit`.
- Общие: `app:error`, `app:ready`.

### Данные и типы
Основные сущности:
- `Product`: id, title, description, category, image, price.
- `BasketItem`: product + quantity.
- `Order`: items, payment, address, email, phone, total.

См. `src/types/index.ts` для полной типизации (экспорт интерфейсов и алиасов).

### Процессы
- «Загрузка каталога»: `app:ready` → запрос `GET /products` → `catalog:loaded` → рендер `GalleryView`.
- «Предпросмотр товара»: клик по карточке → `card:select` → `ModalView.open(CardView)`.
- «Добавление в корзину»: `card:add-to-basket` → `basket:add` → перерасчёт суммы → `basket:changed` → обновить `HeaderView`.
- «Оформление»: `basket:open` → `ModalView.open(BasketView)` → `OrderFormView` → `ContactsFormView` → `order:submit (POST /order)` → `order:success` → `ModalView.open(SuccessView)`.


## Описание базовых компонентов и связей
- «Компонент `GalleryView` отображает коллекцию `Product` в виде сетки карточек `CardView`. При клике по карточке публикует событие `card:select`».
- «Компонент `ModalView` отображает любой произвольный контент, например `CardView` для предпросмотра товара, `BasketView` для корзины или формы заказа `OrderFormView`/`ContactsFormView`».
- «Компонент `BasketView` показывает позиции, генерирует события удаления `basket:remove` и перехода к оформлению `order:open`».

---